<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Chatã‚¢ãƒ—ãƒª</title>
    <!-- ãƒªã‚»ãƒƒãƒˆcssèª­ã¿è¾¼ã¿ -->
    <link rel="stylesheet" href="css/reset.css" />
    <!-- style.cssèª­ã¿è¾¼ã¿ -->
    <link rel="stylesheet" href="css/style.css" />
  </head>

  <body>
    <div class="wrapper">
      <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->
      <div id="line__container" class="line__container">
        <main class="main">
          <div>
            <!-- ãƒªã‚¹ãƒˆè¡¨ç¤º-->
            <div id="output"></div>
          </div>
        </main>
      </div>
      <!--/ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->

      <!-- å…¥åŠ›ç”»é¢ -->
      <div class="input_screen">
        <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
        <div class="">
          <div class="username_screen">
            <p>
              <input type="radio" id="username" name="phase" value="ğŸ—¯" />
              <img
                class="phase-button"
                src="https://s3-ap-northeast-1.amazonaws.com/emoji-img/v6_72/1f5ef.png"
              />

              <input type="radio" id="username" name="phase" value="â”" />
              <img
                class="phase-button"
                src="https://s3-ap-northeast-1.amazonaws.com/emoji-img/v6_72/2754.png"
              />

              <input type="radio" id="username" name="phase" value="ğŸ–¤" />
              <img
                class="phase-button"
                src="https://s3-ap-northeast-1.amazonaws.com/emoji-img/v6_72/1f5a4.png"
              />

              <input type="radio" id="username" name="phase" value="ğŸ¤" />
              <img
                class="phase-button"
                src="https://s3-ap-northeast-1.amazonaws.com/emoji-img/v6_72/1f90d.png"
              />
            </p>
          </div>

          <textarea id="text" rows="3" cols="40"></textarea>
          <input
            type="image"
            id="send"
            class="send-button"
            src="https://s3-ap-northeast-1.amazonaws.com/emoji-img/v6_72/1f4ac.png"
          />
        </div>

        <p id="view_time"></p>
      </div>
      <!--/ å…¥åŠ›ç”»é¢ -->
    </div>

    <!-- ä»¥ä¸‹JavaScripté ˜åŸŸ -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

    <!-- ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç”»é¢æœ€ä¸‹éƒ¨ã‹ã‚‰é–‹å§‹ -->
    <!-- <script>
      let element = document.getElementById("line__container");
      element.scrollIntoView(true);
    </script> -->

    <!-- ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ä¸‹ã®æ™‚è¨ˆ -->
    <script>
      function set2fig(num) {
        // æ¡æ•°ãŒ1æ¡ã ã£ãŸã‚‰å…ˆé ­ã«0ã‚’åŠ ãˆã¦2æ¡ã«èª¿æ•´ã™ã‚‹
        var ret;
        if (num < 10) {
          ret = "0" + num;
        } else {
          ret = num;
        }
        return ret;
      }
      function showClock2() {
        var now = new Date();
        var year = now.getFullYear();
        var mon = set2fig(now.getMonth() + 1); //ï¼‘ã‚’è¶³ã™ã“ã¨
        var day = set2fig(now.getDate());
        var nowTime = new Date();
        var nowHour = set2fig(nowTime.getHours());
        var nowMin = set2fig(nowTime.getMinutes());
        var nowSec = set2fig(nowTime.getSeconds());
        var msg =
          year +
          "/" +
          mon +
          "/" +
          day +
          " " +
          nowHour +
          ":" +
          nowMin +
          ":" +
          nowSec;
        document.getElementById("view_time").innerHTML = msg;
      }
      setInterval("showClock2()", 1000);
    </script>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.5.2/firebase.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
      https://firebase.google.com/docs/web/setup#available-libraries -->

    <script>
      // Your web app's Firebase configuration
      var firebaseConfig = {
        apiKey: "AIzaSyAINLA65hXisCdvbjdKg0Pf2kvy9Pu9G3E",
        authDomain: "gscamp191208.firebaseapp.com",
        databaseURL: "https://gscamp191208.firebaseio.com",
        projectId: "gscamp191208",
        storageBucket: "gscamp191208.appspot.com",
        messagingSenderId: "455094499731",
        appId: "1:455094499731:web:667c8c8682a541caea9066",
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);

      //ä»¥ä¸‹ã€ãƒãƒ£ãƒƒãƒˆå‡¦ç†é ˜åŸŸï¼ˆãƒ¯ãƒ¼ã‚¯ï¼‰

      //é€å—ä¿¡ã®è¨­å®šæº–å‚™
      const newPostRef = firebase.database().ref();

      //MSGé€ä¿¡å‡¦ç†
      $("#send").on("click", function () {
        // console.log("OK")

        newPostRef.push({
          username: $('input[name="phase"]:checked').val(),
          text: $("#text").val(),
        });

        //ãƒ†ã‚­ã‚¹ãƒˆã‚’ç©ºç™½ã«ã™ã‚‹
        $("#text").val("");
      });

      //MSGå—ä¿¡å‡¦ç†
      newPostRef.on("child_added", function (data) {
        let v = data.val();
        let k = data.key;

        //HTMLã«å—ä¿¡ã—ãŸMSGã‚’è¡¨ç¤º
        let str = `<div class="chatset"><p>${v.username}</p><div class="chatset_text"><p>${v.text}</p></div><div class="chatset_time"><p>é€ä¿¡å¹´æœˆæ—¥<br>æ™‚é–“åˆ†ç§’</p></div></div>`;
        $("#output").append(str);
        console.log(v.username);

        let element = document.getElementById("line__container");
        element.scrollIntoView(false);
      });
    </script>
  </body>
</html>
